# ==============================================================
# 5ë‹¨ê³„: ë°ì´í„° ì €ì¥í•˜ê¸° (Excel) ğŸ’¾
# ==============================================================
# 
# ğŸ¯ ì´ íŒŒì¼ì—ì„œ ë°°ìš¸ ë‚´ìš©:
#    - ìŠ¤í¬ë˜í•‘í•œ ë°ì´í„°ë¥¼ ë¦¬ìŠ¤íŠ¸ì™€ ë”•ì…”ë„ˆë¦¬ë¡œ ì •ë¦¬í•˜ê¸°
#    - í˜„ì¬ ë‚ ì§œ êµ¬í•˜ê¸° (datetime ì‚¬ìš©)
#    - ë°ì´í„°ë¥¼ ì—‘ì…€ íŒŒì¼ë¡œ ì €ì¥í•˜ê¸° (pandas ì‚¬ìš©)
#
# ==============================================================

import requests
from bs4 import BeautifulSoup
import pandas as pd  # ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ” ê°•ë ¥í•œ ë„êµ¬! (ì—‘ì…€ ê°™ì€ ì—­í• )
from datetime import datetime  # ë‚ ì§œë¥¼ ë‹¤ë£¨ëŠ” ë„êµ¬

# --------------------------------------------------------------
# ğŸŒ 1. ì›¹ì‚¬ì´íŠ¸ ì ‘ì† ë° ë°ì´í„° ìˆ˜ì§‘ (4ë‹¨ê³„ ë³µìŠµ)
# --------------------------------------------------------------
url = "http://quotes.toscrape.com/"
print(f"ğŸŒ ì‚¬ì´íŠ¸ì— ì ‘ì† ì¤‘... ({url})")

response = requests.get(url)
soup = BeautifulSoup(response.text, "html.parser")

# --------------------------------------------------------------
# ğŸ“¦ 2. ë°ì´í„°ë¥¼ ì €ì¥í•  ê·¸ë¦‡(ë¦¬ìŠ¤íŠ¸) ë§Œë“¤ê¸°
# --------------------------------------------------------------
# ì—¬ëŸ¬ ê°œì˜ ëª…ì–¸ì„ ë‹´ì„ ë¹ˆ ë¦¬ìŠ¤íŠ¸ë¥¼ ë§Œë“­ë‹ˆë‹¤.
# ë‚˜ì¤‘ì— ì´ ë¦¬ìŠ¤íŠ¸ë¥¼ ì—‘ì…€ë¡œ ë³€í™˜í•  ê±°ì˜ˆìš”.
data_list = []

print("ğŸ” ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  ìˆìŠµë‹ˆë‹¤...")

quote_boxes = soup.find_all("div", class_="quote")

for box in quote_boxes:
    # ëª…ì–¸ ë‚´ìš©
    text = box.find("span", class_="text").text
    
    # ë§í•œ ì‚¬ëŒ
    author = box.find("small", class_="author").text
    
    # íƒœê·¸ë“¤ (ì½¤ë§ˆë¡œ ì—°ê²°í•´ì„œ ë¬¸ìì—´ë¡œ ë§Œë“¦)
    tags_div = box.find("div", class_="tags")
    tags = [tag.text for tag in tags_div.select("a.tag")]
    tags_str = ", ".join(tags)  # ['a', 'b'] -> "a, b"
    
    # ë”•ì…”ë„ˆë¦¬(Dictionary) í˜•íƒœë¡œ ë¬¶ì–´ì„œ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
    # ë”•ì…”ë„ˆë¦¬ = { "ì´ë¦„í‘œ": "ê°’" } í˜•íƒœ
    data = {
        "ëª…ì–¸": text,
        "ë§í•œ ì‚¬ëŒ": author,
        "íƒœê·¸": tags_str
    }
    
    print(data)
    
    data_list.append(data)

print(f"âœ… ì´ {len(data_list)}ê°œì˜ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í–ˆìŠµë‹ˆë‹¤!")

# --------------------------------------------------------------
# ğŸ“… 3. íŒŒì¼ ì´ë¦„ ë§Œë“¤ê¸° (ë‚ ì§œ í¬í•¨)
# --------------------------------------------------------------
# í˜„ì¬ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
today = datetime.now()

print(f"today : {today}")

# ë‚ ì§œë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜ (ì˜ˆ: 2026-01-21 -> "2026_01_21")
# %Y: ë…„ë„(4ìë¦¬), %m: ì›”(2ìë¦¬), %d: ì¼(2ìë¦¬)
date_str = today.strftime("%Y_%m_%d")

# íŒŒì¼ ì´ë¦„ ì™„ì„±
file_name = f"quotes_{date_str}.xlsx"

# --------------------------------------------------------------
# ğŸ’¾ 4. ì—‘ì…€ íŒŒì¼ë¡œ ì €ì¥í•˜ê¸° (pandas ì‚¬ìš©)
# --------------------------------------------------------------
print(f"ğŸ’¾ ì—‘ì…€ íŒŒì¼ë¡œ ì €ì¥ ì¤‘... ({file_name})")

# 1) ë¦¬ìŠ¤íŠ¸ë¥¼ ë°ì´í„°í”„ë ˆì„(DataFrame)ìœ¼ë¡œ ë³€í™˜
# ë°ì´í„°í”„ë ˆì„ = íŒŒì´ì¬ ì•ˆì˜ ì—‘ì…€ í‘œ
df = pd.DataFrame(data_list)

# 2) ì—‘ì…€ íŒŒì¼ë¡œ ì €ì¥
# index=False : 0, 1, 2... ê°™ì€ ìˆœì„œ ë²ˆí˜¸ëŠ” ì €ì¥í•˜ì§€ ì•ŠìŒ
df.to_excel(file_name, index=False)

print("ğŸ‰ ì €ì¥ ì™„ë£Œ!")
print(f"ğŸ“ íŒŒì¼ ìœ„ì¹˜: {file_name}")
print("-" * 50)
print(" ìˆ˜ì§‘ëœ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°:")
print("-" * 50)
print(df.head())  # ì²˜ìŒ 5ì¤„ë§Œ ì¶œë ¥í•´ì„œ í™•ì¸
